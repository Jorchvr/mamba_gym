<%= stylesheet_link_tag "main_panel", media: "all", "data-turbo-track": "reload" %>

<div class="card">
  <div class="header-row" style="justify-content: space-between; align-items: center;">
    <h2 class="title">Clientes</h2>
    <div class="btn-row">
      <%= link_to "Inicio", authenticated_root_path, class: "btn" %>
      <%= link_to "Registrar Cliente", new_client_path, class: "btn btn-primary" %>
    </div>
  </div>

  <!-- üîé Buscador -->
  <%= form_with url: clients_path, method: :get, local: true do %>
    <div class="search-row" style="display:flex; gap:.5rem; flex-wrap:wrap; margin-bottom:.75rem;">
      <%= select_tag :filter,
        options_for_select([["N√∫mero", "id"], ["Nombre", "name"]], params[:filter].presence || "name"),
        class: "form-select" %>

      <%= text_field_tag :q, params[:q],
        placeholder: "Buscar por n√∫mero o nombre‚Ä¶",
        class: "form-input",
        style: "min-width:260px; flex:1 1 260px;" %>

      <%= submit_tag "Buscar", class: "btn btn-accent" %>
    </div>
  <% end %>

  <!-- Tabla con scroll -->
  <div class="table-wrap clients-scroll">
    <table class="nice-table" style="width:100%; border-collapse:collapse;">
      <thead>
        <tr>
          <th style="text-align:left; padding:.5rem; border-bottom:1px solid var(--border);">#</th>
          <th style="text-align:left; padding:.5rem; border-bottom:1px solid var(--border);">Nombre</th>
          <th style="text-align:left; padding:.5rem; border-bottom:1px solid var(--border);">Membres√≠a</th>
          <th style="text-align:left; padding:.5rem; border-bottom:1px solid var(--border);">Inscripci√≥n</th>
          <th style="text-align:left; padding:.5rem; border-bottom:1px solid var(--border);">Pr√≥ximo pago</th>
          <th style="text-align:left; padding:.5rem; border-bottom:1px solid var(--border);">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <% @clients.each do |c| %>
          <tr style="border-top:1px solid var(--border);">
            <td class="muted" style="padding:.5rem;"><%= c.id %></td>
            <td style="padding:.5rem;">
              <div class="name-cell" style="display:flex; align-items:center; gap:.5rem; flex-wrap:wrap;">
                <%= link_to (c.name.presence || "(Sin nombre)"), client_path(c), class: "link-strong" %>
                <% if c.next_payment_on.present? && c.next_payment_on < Date.current %>
                  <span class="badge badge-danger">Vencida</span>
                <% elsif c.next_payment_on.present? %>
                  <span class="badge badge-ok">Activa</span>
                <% else %>
                  <span class="badge">Sin plan</span>
                <% end %>
              </div>
            </td>
            <td style="padding:.5rem;"><span class="mono"><%= c.membership_type&.humanize || "-" %></span></td>
            <td style="padding:.5rem;"><span class="mono"><%= c.enrolled_on || "-" %></span></td>
            <td style="padding:.5rem;"><span class="mono"><%= c.next_payment_on || "-" %></span></td>
            <td style="padding:.5rem;">
              <div class="actions-stack" style="display:flex; gap:.4rem; flex-wrap:wrap;">
                <%= link_to "Ver", client_path(c), class: "btn btn-sm" %>
                <%= link_to "Editar", edit_client_path(c), class: "btn btn-sm btn-primary" %>
              </div>
            </td>
          </tr>
        <% end %>

        <% if @clients.blank? %>
          <tr>
            <td colspan="6" class="muted" style="text-align:center; padding:1.25rem 0;">
              No hay clientes que coincidan con la b√∫squeda.
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
